<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="icon" href="{% static 'img/site-pic.ico' %}"type="image/icon type"/>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" />
    <title>Weather Forecast</title>
</head>
<body>
    <main class="{{ description }}">
        <section class="side-container">
            <form method="POST">
                {% csrf_token %}
                <div class="search-container">
                    <div style="width: 22px; height: 22px; color: white;" class="weather-icon">
                        <i class="bi bi-cloud-fog-fill"></i>
                    </div>
                        <input 
                            type="text" 
                            name="city"
                            class="geo-input"
                            placeholder="ex. Lahore England"
                            value="{{ location }}"

                        />
                        <button class="search-button">
                            <div style="width: 25px; height: 25px; color: white;" >
                                <i class="bi bi-search"></i>
                            </div>
                        </button>

                </div>

            </form>
            <div class="day-stats">
                <h2 class="day-stats__temperature">
                    <span class="day-stats__temperature_value">{{ current_temp }}</span>°
                </h2>
                <h3 class="day-stats__feelslike">
                    Feels like: <span class="day-stats__feelslike_value">{{ FeelsLike }}</span>°
                </h3>
                <ul class="day-stats_condation">
                    <li>
                        <p class="day-stats_condition">{{ humidity }}%</p>
                        <p class="day-stats__condition_text">of humidity</p>
                    </li>
                    <li>
                        <p class="day-stats_condition">{{ clouds }}%</p>
                        <p class="day-stats__condition_text">of cloudy</p>
                    </li>
                </ul>
            </div>
            
            <img src="{%static 'img/side-blur.png' %}" class="side-blur" alt="blur"/>
         </section>

         <section class="main-container">
            <a href="{% url 'map' %}" class="map-button">Map</a>
            <h4 class="secondary-title">Weather Forecast</h4>
            <h1 class="weather__primary-title">{{ description }}</h1>
            <div class="weather__location">
            <div style="width: 15px; height: 15px; color: white;" class="location-icon">
                <i class="bi bi-geo-alt"></i>
            </div>
            <P class="weather__location-text">
                <span class="weather__location-city">{{ city }} </span>
                <span class="weather__location-country">{{ country }} </span>
                <span class="weather__location-date">{{ time }}</span>
            </P> 
            </div>
            <p class="weather__primary-stats">
                Wind
                <span class="weatherWindKph">{{ wind }}</span> kilometers per hour. Pressure
                is <span class="weatherPressure">{{ pressure }}</span> mb. Visibility is
                <span class="weatherSnow">{{ visibility }}</span>. Maximum temperature is
                <span class="weatherMaxTemp">{{ MaxTemp }}</span>°. Minimum temperature is
                <span class="weatherMinTemp">{{ MinTemp }}</span>°.

            </p>

            <ul class="forecast">
                <li class="forecast-item">
                    <p class="forecast-time">{{ time1 }} </p>
                    <p class="forecast-temperature">
                    &nbsp;<span class="forecast-temperatureValue">{{ temp1 }}</span>
                    </p>
                    <p class="forecastwindText">
                        Humidity: <span class="forecast-humidityValue">{{ hum1 }}</span>

                    </p>
                </li>
                <li class="forecast-item">
                    <p class="forecast-time">{{ time2 }} </p>
                    <p class="forecast-temperature">
                    &nbsp;<span class="forecast-temperatureValue">{{ temp2 }}</span>
                    </p>
                    <p class="forecastwindText">
                        Humidity: <span class="forecast-humidityValue">{{ hum2 }}</span>

                    </p>
                </li>
                <li class="forecast-item">
                    <p class="forecast-time">{{ time3 }} </p>
                    <p class="forecast-temperature">
                    &nbsp;<span class="forecast-temperatureValue">{{ temp3 }}</span>
                    </p>
                    <p class="forecastwindText">
                        Humidity: <span class="forecast-humidityValue">{{ hum3 }}</span>

                    </p>
                </li>
                <li class="forecast-item">
                    <p class="forecast-time">{{ time4 }} </p>
                    <p class="forecast-temperature">
                    &nbsp;<span class="forecast-temperatureValue">{{ temp4 }}</span>
                    </p>
                    <p class="forecastwindText">
                        Humidity: <span class="forecast-humidityValue">{{ hum4 }}</span>

                    </p>
                </li>
                <li class="forecast-item">
                    <p class="forecast-time">{{ time5 }} </p>
                    <p class="forecast-temperature">
                    &nbsp;<span class="forecast-temperatureValue">{{ temp5 }}</span>
                    </p>
                    <p class="forecastwindText">
                        Humidity: <span class="forecast-humidityValue">{{ hum5 }}</span>

                    </p>
                </li>
            </ul>

            <canvas id="chart" height="45px"></canvas>
            
            <!-- Add this right after your chart canvas -->
           <div class="weekly-forecast-section">
    <h4 class="section-heading"><i class="bi bi-calendar-week"></i> 7-Day Forecast</h4>
    <div class="forecast-grid">
        <div class="forecast-grid-inner" id="weeklyForecast">
            <!-- Days will be populated by JavaScript -->
        </div>
    </div>
</div>
            
            <style>
            /* Expanded Weekly Forecast Styles */
            .weekly-forecast-section {
                width: 100%;
                margin-top: 30px;
            }
            
            .section-heading {
                color: rgba(255, 255, 255, 0.9);
                font-size: 14px;
                font-weight: 400;
                margin-bottom: 15px;
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .forecast-grid {
                width: 100%;
                overflow: hidden;
            }
            
            .forecast-grid-inner {
                display: grid;
                grid-template-columns: repeat(7, 1fr);
                gap: 12px;
                width: 100%;
            }
            
            .forecast-day-card {
                padding: 18px 12px;
                background: rgba(255, 255, 255, 0.08);
                border-radius: 12px;
                backdrop-filter: blur(15px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                text-align: center;
                transition: all 0.3s ease;
                display: flex;
                flex-direction: column;
                align-items: center;
                height: 100%;
            }
            
            .forecast-day-card:hover {
                background: rgba(255, 255, 255, 0.15);
                transform: translateY(-3px);
            }
            
            .forecast-day-card.today {
                background: rgba(67, 97, 238, 0.2);
                border-color: rgba(67, 97, 238, 0.4);
            }
            
            .day-name {
                color: #fff;
                font-size: 14px;
                font-weight: 400;
                margin-bottom: 12px;
            }
            
            .day-icon {
                font-size: 32px;
                color: #4cc9f0;
                margin-bottom: 10px;
                flex-grow: 1;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .day-temps {
                display: flex;
                justify-content: center;
                gap: 10px;
                margin-bottom: 8px;
                width: 100%;
            }
            
            .day-high {
                color: #fff;
                font-size: 16px;
                font-weight: 500;
            }
            
            .day-low {
                color: rgba(255, 255, 255, 0.7);
                font-size: 16px;
            }
            
            .day-condition {
                color: rgba(255, 255, 255, 0.8);
                font-size: 13px;
                font-weight: 300;
                width: 100%;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            /* Responsive adjustments */
            @media (max-width: 1200px) {
                .forecast-grid-inner {
                    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                }
            }
            
            @media (max-width: 768px) {
                .forecast-grid {
                    overflow-x: auto;
                    padding-bottom: 10px;
                }
                
                .forecast-grid-inner {
                    grid-template-columns: repeat(7, 140px);
                    width: max-content;
                }
                
                .forecast-day-card {
                    padding: 15px 10px;
                }
                
                .day-icon {
                    font-size: 28px;
                }
            }
            </style>
        </section>

    </main>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="{% static 'js/chartSetup.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Sample data - replace with your actual API data
            const weeklyData = [
                { dayOffset: 0, high: 28, low: 22, condition: 'Sunny' },
                { dayOffset: 1, high: 26, low: 21, condition: 'Partly Cloudy' },
                { dayOffset: 2, high: 24, low: 19, condition: 'Showers' },
                { dayOffset: 3, high: 23, low: 18, condition: 'Thunderstorms' },
                { dayOffset: 4, high: 25, low: 20, condition: 'Partly Cloudy' },
                { dayOffset: 5, high: 27, low: 22, condition: 'Sunny' },
                { dayOffset: 6, high: 26, low: 21, condition: 'Cloudy' }
            ];
        
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const today = new Date();
            const forecastContainer = document.getElementById('weeklyForecast');
        
            forecastContainer.innerHTML = weeklyData.map(day => {
                const date = new Date();
                date.setDate(today.getDate() + day.dayOffset);
                const isToday = day.dayOffset === 0;
                const dayName = isToday ? 'Today' : dayNames[date.getDay()];
                const iconClass = getWeatherIcon(day.condition);
        
                return `
                <div class="forecast-day-card ${isToday ? 'today' : ''}">
                    <div class="day-name">${dayName}</div>
                    <i class="bi ${iconClass} day-icon"></i>
                    <div class="day-temps">
                        <span class="day-high">${day.high}°</span>
                        <span class="day-low">${day.low}°</span>
                    </div>
                    <div class="day-condition">${day.condition}</div>
                </div>
                `;
            }).join('');
        
            function getWeatherIcon(condition) {
                const iconMap = {
                    'sunny': 'bi-sun',
                    'clear': 'bi-sun',
                    'partly cloudy': 'bi-cloud-sun',
                    'cloudy': 'bi-cloud',
                    'rain': 'bi-cloud-rain',
                    'showers': 'bi-cloud-rain-heavy',
                    'thunderstorm': 'bi-cloud-lightning-rain',
                    'snow': 'bi-snow',
                    'mist': 'bi-cloud-fog',
                    'fog': 'bi-cloud-fog',
                    'haze': 'bi-cloud-haze'
                };
                return iconMap[condition.toLowerCase()] || 'bi-question-circle';
            }
        
            // Uncomment to use with real API
            
            async function fetchWeeklyForecast() {
                try {
                    const response = await fetch(`/api/weekly-forecast?city=${encodeURIComponent('{{ city }}')}`);
                    const data = await response.json();
                    updateForecast(data);
                } catch (error) {
                    console.error('Error fetching weekly forecast:', error);
                }
            }
            
            function updateForecast(data) {
                // Process your API data here
            }
            
            fetchWeeklyForecast();
            
        });
        </script>
</body>
</html>